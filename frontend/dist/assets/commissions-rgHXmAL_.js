import{c as K,x as se,y as te,u as ae,v as B,z as U,d as A,r as d,j as e,b as q,E as ie,B as v,D as F,U as re,F as ne,C as le}from"./index-CqXPVSZC.js";import{C as V,a as G,b as O,c as z,d as oe}from"./card-Bw-7kV4D.js";import{S as H,a as k,b as M,c as W,d as c}from"./select-YAQpxFmL.js";import{T as ce,a as de,b as R,c as S,d as me,e as f}from"./table-n7dG2OWS.js";import{S as $}from"./skeleton-Bm01ltWI.js";import{B as ue}from"./badge-DFYqZBp3.js";import{D as he,a as xe,b as pe,c as je,d as ge}from"./dialog-n4gnCksP.js";import{I as ve}from"./input-3cV1rw2q.js";import{L as fe}from"./label-Cax8PUHg.js";import{A as ye}from"./arrow-up-right-BfCWTSMI.js";import"./index-CS_b7JuV.js";import"./index-iqQhCvhl.js";import"./check-CrDJZiF-.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=K("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=K("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function Ne(m={}){const r=se(),{toast:n}=te();ae();const{page:j=1,limit:u=10,type:y=null,status:h=null,userId:x=null,isAdmin:w=!1}=m,C=y==="All"?null:y,g=h==="All"?null:h,{data:E=null,isLoading:L,error:p}=B({queryKey:["commissionStats",x],queryFn:async()=>{const a=x?`/commissions/stats/${x}`:"/commissions/stats",{data:l}=await A.get(a);return l.data},staleTime:1e3*60*5}),{data:t={commissions:[],total:0,pages:0},isLoading:N,error:P,refetch:b}=B({queryKey:["commissionHistory",{page:j,limit:u,transformedType:C,transformedStatus:g,userId:x,isAdmin:w}],queryFn:async()=>{try{const a=w?"commissions/admin":"commissions",l={page:j,limit:u,...C&&{type:C},...g&&{status:g},...x&&{userId:x}},{data:o}=await A.get(a,{params:l});if(!o.success)throw new Error(o.error||"Failed to fetch commission history");return{commissions:o.data||[],total:o.total||0,pages:o.pages||0}}catch(a){throw console.error("Commission history error:",a),n({title:"Error",description:a.message||"Failed to fetch commission history",variant:"destructive"}),a}},staleTime:1e3*60*5}),T=U({mutationFn:async a=>{const{data:l}=await A.post("/commissions/withdraw",a);return l},onSuccess:a=>{n({title:"Withdrawal Successful",description:`Withdrawal of ${a.amount} processed successfully.`,variant:"success"}),r.invalidateQueries(["commissionStats"]),r.invalidateQueries(["commissionHistory"])},onError:a=>{var l,o;n({title:"Withdrawal Failed",description:((o=(l=a.response)==null?void 0:l.data)==null?void 0:o.message)||"An error occurred during withdrawal.",variant:"destructive"})}}),D=U({mutationFn:async()=>{const{data:a}=await A.post("/commissions/process-queue");return a},onSuccess:()=>{n({title:"Queue Processed",description:"Commission queue processed successfully.",variant:"success"}),r.invalidateQueries(["commissionStats"]),r.invalidateQueries(["commissionHistory"])},onError:a=>{var l,o;n({title:"Processing Failed",description:((o=(l=a.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to process commission queue.",variant:"destructive"})}});return{commissionStats:E,commissionHistory:t.commissions,totalCommissions:t.total,totalPages:t.pages,statsLoading:L,historyLoading:N,statsError:p,historyError:P,refetchHistory:b,withdraw:T.mutate,isWithdrawing:T.isLoading,processQueue:D.mutate,isProcessingQueue:D.isLoading}}const be=ie("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),X=d.forwardRef(({className:m,variant:r,...n},j)=>e.jsx("div",{ref:j,role:"alert",className:q(be({variant:r}),m),...n}));X.displayName="Alert";const Se=d.forwardRef(({className:m,...r},n)=>e.jsx("h5",{ref:n,className:q("mb-1 font-medium leading-none tracking-tight",m),...r}));Se.displayName="AlertTitle";const Y=d.forwardRef(({className:m,...r},n)=>e.jsx("div",{ref:n,className:q("text-sm [&_p]:leading-relaxed",m),...r}));Y.displayName="AlertDescription";function Ie(){const[m,r]=d.useState(!1),[n,j]=d.useState("all-time"),[u,y]=d.useState(""),[h,x]=d.useState(1),[w,C]=d.useState(""),[g,E]=d.useState(""),[L]=d.useState(10),p=s=>{const i=Number(s);return!s||isNaN(i)?"UGX 0":`UGX ${i.toLocaleString("en-US")}`},{commissionStats:t,commissionHistory:N,totalCommissions:P,totalPages:b,statsLoading:T,historyLoading:D,isWithdrawing:a,refetchHistory:l,withdraw:o}=Ne({page:h,limit:L,type:w||null,status:g||null}),_=()=>{if(!u||isNaN(u))return;const s=parseFloat(u);s<=0||(o({amount:s}),r(!1),y(""))},I=s=>{x(s)},Q=(s,i)=>{s==="type"&&C(i),s==="status"&&E(i),x(1)},J=()=>{if(T)return e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(i=>e.jsx($,{className:"h-40 w-full"},i))});const s=[{title:"Total Commissions",value:p((t==null?void 0:t.totalCommissions)||0),description:"Lifetime earnings from commissions",icon:F,color:"text-green-500"},{title:"Direct Commissions",value:p((t==null?void 0:t.directCommissions)||0),description:"Earnings from direct referrals",icon:re,color:"text-blue-500"},{title:"Matching Commissions",value:p((t==null?void 0:t.matchingCommissions)||0),description:"Earnings from team matching",icon:ye,color:"text-purple-500"},{title:"Level Commissions",value:p((t==null?void 0:t.levelCommissions)||0),description:"Earnings from level bonuses",icon:F,color:"text-green-500"}];return e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map((i,ee)=>e.jsxs(V,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:i.title}),e.jsx("div",{className:"rounded-full p-2 bg-muted",children:e.jsx(i.icon,{className:`h-4 w-4 ${i.color}`})})]}),e.jsxs(z,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.description})]})]},ee))})},Z=()=>D?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(s=>e.jsx($,{className:"h-12 w-full"},s))}):e.jsxs(V,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Commission History"}),e.jsxs(oe,{children:["Showing ",N.length," of ",P," transactions"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(H,{value:w,onValueChange:s=>Q("type",s),children:[e.jsx(k,{className:"w-[140px]",children:e.jsx(M,{placeholder:"Filter Type"})}),e.jsxs(W,{children:[e.jsx(c,{value:"All",children:"All Types"}),e.jsx(c,{value:"DIRECT",children:"Direct"}),e.jsx(c,{value:"MATCHING",children:"Matching"}),e.jsx(c,{value:"LEVEL",children:"Level"})]})]}),e.jsxs(H,{value:g,onValueChange:s=>Q("status",s),children:[e.jsx(k,{className:"w-[140px]",children:e.jsx(M,{placeholder:"Filter Status"})}),e.jsxs(W,{children:[e.jsx(c,{value:"All",children:"All Status"}),e.jsx(c,{value:"PENDING",children:"Pending"}),e.jsx(c,{value:"PROCESSED",children:"Processed"}),e.jsx(c,{value:"WITHDRAWN",children:"Withdrawn"})]})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>l(),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"})," Refresh"]})]})]}),e.jsxs(z,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(R,{children:[e.jsx(S,{children:"Type"}),e.jsx(S,{children:"Amount"}),e.jsx(S,{children:"From"}),e.jsx(S,{children:"Date"}),e.jsx(S,{children:"Status"})]})}),e.jsx(me,{children:N.length===0?e.jsx(R,{children:e.jsx(f,{colSpan:5,className:"text-center py-4",children:"No commission records found"})}):N.map(s=>{var i;return e.jsxs(R,{children:[e.jsx(f,{children:s.type}),e.jsx(f,{className:"font-medium",children:p(s.amount)}),e.jsx(f,{children:((i=s.sourceUser)==null?void 0:i.username)||"System"}),e.jsx(f,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(f,{children:e.jsx(ue,{variant:s.status==="PROCESSED"?"success":s.status==="PENDING"?"secondary":"destructive",children:s.status})})]},s.id)})})]}),b>1&&e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",h," of ",b]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>I(h-1),disabled:h===1,children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>I(h+1),disabled:h===b,children:e.jsx(le,{className:"h-4 w-4"})})]})]})]})]});return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"My Commissions"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(H,{value:n,onValueChange:j,children:[e.jsx(k,{className:"w-[180px]",children:e.jsx(M,{placeholder:"Select period"})}),e.jsxs(W,{children:[e.jsx(c,{value:"all-time",children:"All Time"}),e.jsx(c,{value:"this-month",children:"This Month"}),e.jsx(c,{value:"last-month",children:"Last Month"}),e.jsx(c,{value:"this-year",children:"This Year"})]})]}),e.jsxs(v,{variant:"outline",onClick:()=>r(!0),children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Withdraw"]}),e.jsxs(v,{variant:"outline",children:[e.jsx(we,{className:"mr-2 h-4 w-4"})," Export"]})]})]}),J(),Z(),e.jsx(he,{open:m,onOpenChange:r,children:e.jsxs(xe,{children:[e.jsxs(pe,{children:[e.jsx(je,{children:"Withdraw Commissions"}),e.jsx(ge,{children:"Enter the amount you want to withdraw from your available balance."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"amount",children:"Withdrawal Amount"}),e.jsx(ve,{id:"amount",type:"number",min:"0",step:"0.01",placeholder:"Enter amount",value:u,onChange:s=>y(s.target.value)})]}),(t==null?void 0:t.availableBalance)&&e.jsx(X,{children:e.jsxs(Y,{children:["Available Balance: ",p(t.availableBalance)]})}),e.jsx(v,{onClick:_,disabled:a||!u||parseFloat(u)<=0,className:"w-full",children:a?"Processing...":"Confirm Withdrawal"})]})]})})]})}export{Ie as default};
